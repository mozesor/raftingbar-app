<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>רפטינג בר - עמוד דוחות מלא</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            overflow-x: hidden;
        }

        .container {
            padding: 15px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px 15px 15px;
            text-align: center;
            color: white;
            border-radius: 20px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .card h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .report-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .report-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .report-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }

        .report-desc {
            font-size: 0.9em;
            color: #666;
            line-height: 1.4;
        }

        .filters-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            color: #555;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            transition: all 0.3s;
        }

        .form-group select:focus,
        .form-group input:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-info {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: #667eea;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: bold;
        }

        .data-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .overtime-cell {
            background: #fff3cd !important;
            color: #856404;
            font-weight: bold;
        }

        .absent-cell {
            background: #f8d7da !important;
            color: #721c24;
        }

        .late-cell {
            background: #d1ecf1 !important;
            color: #0c5460;
        }

        .quick-date-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .quick-date-btn {
            padding: 6px 12px;
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #bbdefb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .quick-date-btn:hover,
        .quick-date-btn.active {
            background: #1976d2;
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .payroll-section {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .payroll-section h3 {
            margin-bottom: 15px;
        }

        .payroll-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .payroll-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 דוחות ותובנות - רפטינג בר</h1>
            <p>ניתוח מתקדם של נתוני נוכחות ושעות עבודה</p>
        </div>

        <div id="alertContainer"></div>

        <!-- כרטיסי דוחות מהירים -->
        <div class="card">
            <h2>🚀 דוחות מהירים</h2>
            <div class="reports-grid">
                <div class="report-card" onclick="generateDailyReport()">
                    <div class="report-icon">📅</div>
                    <div class="report-title">דוח יומי</div>
                    <div class="report-desc">סיכום נוכחות ושעות עבודה להיום</div>
                </div>
                
                <div class="report-card" onclick="generateWeeklyReport()">
                    <div class="report-icon">📈</div>
                    <div class="report-title">דוח שבועי</div>
                    <div class="report-desc">ניתוח שבוע אחרון עם מגמות</div>
                </div>
                
                <div class="report-card" onclick="generateMonthlyReport()">
                    <div class="report-icon">📊</div>
                    <div class="report-title">דוח חודשי</div>
                    <div class="report-desc">סיכום מפורט לחודש הנוכחי</div>
                </div>
                
                <div class="report-card" onclick="generateWorkDaysReport()">
                    <div class="report-icon">🗓️</div>
                    <div class="report-title">דוח ימי עבודה</div>
                    <div class="report-desc">ספירת ימי עבודה לפי תקופה</div>
                </div>
                
                <div class="report-card" onclick="generateOvertimeReport()">
                    <div class="report-icon">🌙</div>
                    <div class="report-title">דוח שעות נוספות</div>
                    <div class="report-desc">מעקב שעות מעל 9 ביום</div>
                </div>
                
                <div class="report-card" onclick="generatePayrollReport()">
                    <div class="report-icon">💰</div>
                    <div class="report-title">דוח שכר</div>
                    <div class="report-desc">נתונים למחלקת שכר</div>
                </div>
            </div>
        </div>

        <!-- מסנני דוחות -->
        <div class="card">
            <h2>🔍 דוחות מותאמים אישית</h2>
            <div class="filters-section">
                <div class="filters-grid">
                    <div class="form-group">
                        <label>בחר עובד:</label>
                        <select id="employeeFilter">
                            <option value="all">כל העובדים</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>מתאריך:</label>
                        <input type="date" id="startDate">
                    </div>
                    
                    <div class="form-group">
                        <label>עד תאריך:</label>
                        <input type="date" id="endDate">
                    </div>
                    
                    <div class="form-group">
                        <label>סוג דוח:</label>
                        <select id="reportType">
                            <option value="summary">סיכום כללי</option>
                            <option value="detailed">מפורט</option>
                            <option value="hours">שעות בלבד</option>
                            <option value="attendance">נוכחות בלבד</option>
                            <option value="overtime">שעות נוספות</option>
                            <option value="workdays">ימי עבודה</option>
                        </select>
                    </div>
                </div>
                
                <div class="quick-date-btns">
                    <div class="quick-date-btn" onclick="setDateRange('today')">היום</div>
                    <div class="quick-date-btn" onclick="setDateRange('yesterday')">אתמול</div>
                    <div class="quick-date-btn" onclick="setDateRange('week')">השבוע</div>
                    <div class="quick-date-btn" onclick="setDateRange('lastweek')">שבוע שעבר</div>
                    <div class="quick-date-btn" onclick="setDateRange('month')">החודש</div>
                    <div class="quick-date-btn" onclick="setDateRange('lastmonth')">חודש שעבר</div>
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <button class="btn btn-primary" onclick="generateCustomReport()">📋 צור דוח מותאם</button>
                    <button class="btn btn-success" onclick="exportToExcel()">📤 ייצא לאקסל</button>
                    <button class="btn btn-info" onclick="emailReport()">📧 שלח במייל</button>
                    <button class="btn btn-warning" onclick="sendToPayroll()">💰 שלח לשכר</button>
                </div>
            </div>
        </div>

        <!-- סטטיסטיקות מהירות -->
        <div class="card">
            <h2>📈 סטטיסטיקות מהירות</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="todayHours">0</div>
                    <div class="stat-label">שעות היום</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeEmployees">0</div>
                    <div class="stat-label">עובדים פעילים</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="weeklyHours">0</div>
                    <div class="stat-label">שעות השבוע</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="overtimeHours">0</div>
                    <div class="stat-label">שעות נוספות</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="workDaysCount">0</div>
                    <div class="stat-label">ימי עבודה החודש</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDaily">0</div>
                    <div class="stat-label">ממוצע יומי</div>
                </div>
            </div>
        </div>

        <!-- תוצאות דוח -->
        <div class="card" id="reportResults" style="display: none;">
            <h2>📊 תוצאות הדוח</h2>
            <div id="reportContent"></div>
        </div>

        <!-- סעיף שכר -->
        <div class="payroll-section" id="payrollSection" style="display: none;">
            <h3>💰 נתונים למחלקת שכר</h3>
            <div class="payroll-info" id="payrollInfo"></div>
            <div style="margin-top: 20px;">
                <button class="btn btn-success" onclick="exportPayrollData()" style="background: rgba(255,255,255,0.2); border: 2px solid white;">
                    📤 ייצא נתוני שכר
                </button>
                <button class="btn btn-info" onclick="emailPayrollData()" style="background: rgba(255,255,255,0.2); border: 2px solid white;">
                    📧 שלח למחלקת שכר
                </button>
            </div>
        </div>
    </div>

    <script>
        // משתנים גלובליים
        var employees = [];
        var attendanceData = {};
        var currentStatus = {};

        // טעינת נתונים מ-localStorage
        function loadData() {
            try {
                var savedEmployees = localStorage.getItem('raftingbar_employees');
                if (savedEmployees) {
                    employees = JSON.parse(savedEmployees);
                    updateEmployeeFilter();
                }
                
                var savedAttendance = localStorage.getItem('raftingbar_attendance');
                if (savedAttendance) {
                    attendanceData = JSON.parse(savedAttendance);
                }
                
                var savedStatus = localStorage.getItem('raftingbar_status');
                if (savedStatus) {
                    currentStatus = JSON.parse(savedStatus);
                }
                
                updateStatistics();
            } catch (e) {
                console.log('שגיאה בטעינת נתונים:', e);
            }
        }

        // עדכון רשימת עובדים במסנן
        function updateEmployeeFilter() {
            var select = document.getElementById('employeeFilter');
            select.innerHTML = '<option value="all">כל העובדים</option>';
            
            for (var i = 0; i < employees.length; i++) {
                var option = document.createElement('option');
                option.value = employees[i];
                option.text = employees[i];
                select.appendChild(option);
            }
        }

        // פונקציות עזר
        function getCurrentDate() {
            var today = new Date();
            var year = today.getFullYear();
            var month = String(today.getMonth() + 1).padStart(2, '0');
            var day = String(today.getDate()).padStart(2, '0');
            return year + '-' + month + '-' + day;
        }

        function formatTime(dateString) {
            if (!dateString) return '-';
            var date = new Date(dateString);
            return String(date.getHours()).padStart(2, '0') + ':' + String(date.getMinutes()).padStart(2, '0');
        }

        function calculateHours(start, end) {
            if (!start) return 0;
            
            var startDate = new Date(start);
            var endDate = end ? new Date(end) : new Date();
            
            if (isNaN(startDate.getTime()) || isNaN(endDate.getTime())) {
                return 0;
            }
            
            if (endDate < startDate) {
                return 0;
            }
            
            var diff = endDate - startDate;
            var hours = diff / (1000 * 60 * 60);
            return Math.max(0, Math.round(hours * 100) / 100);
        }

        function isOvertime(hours) {
            return hours > 9;
        }

        function showAlert(message, type) {
            var container = document.getElementById('alertContainer');
            var alert = document.createElement('div');
            alert.className = 'alert alert-' + type;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(function() {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 4000);
        }

        // הגדרת תאריכים ברירת מחדל
        function setDefaultDates() {
            var today = new Date();
            var weekAgo = new Date(today);
            weekAgo.setDate(today.getDate() - 7);
            
            document.getElementById('startDate').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        }

        // הגדרת טווח תאריכים מהיר
        function setDateRange(range) {
            var today = new Date();
            var startDate = document.getElementById('startDate');
            var endDate = document.getElementById('endDate');
            
            document.querySelectorAll('.quick-date-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            switch(range) {
                case 'today':
                    startDate.value = today.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'yesterday':
                    var yesterday = new Date(today);
                    yesterday.setDate(today.getDate() - 1);
                    startDate.value = yesterday.toISOString().split('T')[0];
                    endDate.value = yesterday.toISOString().split('T')[0];
                    break;
                case 'week':
                    var weekStart = new Date(today);
                    weekStart.setDate(today.getDate() - today.getDay());
                    startDate.value = weekStart.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'lastweek':
                    var lastWeekEnd = new Date(today);
                    lastWeekEnd.setDate(today.getDate() - today.getDay() - 1);
                    var lastWeekStart = new Date(lastWeekEnd);
                    lastWeekStart.setDate(lastWeekEnd.getDate() - 6);
                    startDate.value = lastWeekStart.toISOString().split('T')[0];
                    endDate.value = lastWeekEnd.toISOString().split('T')[0];
                    break;
                case 'month':
                    var monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                    startDate.value = monthStart.toISOString().split('T')[0];
                    endDate.value = today.toISOString().split('T')[0];
                    break;
                case 'lastmonth':
                    var lastMonthStart = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    var lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                    startDate.value = lastMonthStart.toISOString().split('T')[0];
                    endDate.value = lastMonthEnd.toISOString().split('T')[0];
                    break;
            }
        }

        // עדכון סטטיסטיקות
        function updateStatistics() {
            var activeCount = 0;
            var totalTodayHours = 0;
            var totalWeeklyHours = 0;
            var totalOvertimeHours = 0;
            var workDaysThisMonth = 0;
            var today = getCurrentDate();
            
            // חישוב שבוע נוכחי
            var weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            var weekDates = [];
            for (var i = 0; i < 7; i++) {
                var date = new Date(weekStart);
                date.setDate(weekStart.getDate() + i);
                var dateStr = date.getFullYear() + '-' + 
                    String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(date.getDate()).padStart(2, '0');
                weekDates.push(dateStr);
            }
            
            // חישוב חודש נוכחי
            var monthStart = new Date();
            monthStart.setDate(1);
            var monthDates = [];
            var currentMonth = new Date();
            for (var d = new Date(monthStart); d <= currentMonth; d.setDate(d.getDate() + 1)) {
                var dateStr = d.getFullYear() + '-' + 
                    String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(d.getDate()).padStart(2, '0');
                monthDates.push(dateStr);
            }
            
            for (var i = 0; i < employees.length; i++) {
                var employee = employees[i];
                
                // עובדים פעילים
                if (currentStatus[employee] === 'in') {
                    activeCount++;
                }
                
                // שעות היום
                var todayData = attendanceData[employee] && attendanceData[employee][today];
                if (todayData && todayData.checkIn) {
                    var endTime = todayData.checkOut || null;
                    var hours = calculateHours(todayData.checkIn, endTime);
                    totalTodayHours += hours;
                    
                    if (isOvertime(hours)) {
                        totalOvertimeHours += (hours - 9);
                    }
                }
                
                // שעות השבוע
                for (var w = 0; w < weekDates.length; w++) {
                    var weekData = attendanceData[employee] && attendanceData[employee][weekDates[w]];
                    if (weekData && weekData.checkIn) {
                        var weekHours = calculateHours(weekData.checkIn, weekData.checkOut);
                        totalWeeklyHours += weekHours;
                        
                        if (isOvertime(weekHours)) {
                            totalOvertimeHours += (weekHours - 9);
                        }
                    }
                }
                
                // ימי עבודה החודש
                for (var m = 0; m < monthDates.length; m++) {
                    var monthData = attendanceData[employee] && attendanceData[employee][monthDates[m]];
                    if (monthData && monthData.checkIn) {
                        workDaysThisMonth++;
                    }
                }
            }
            
            // עדכון UI
            document.getElementById('todayHours').textContent = Math.round(totalTodayHours * 10) / 10;
            document.getElementById('activeEmployees').textContent = activeCount;
            document.getElementById('weeklyHours').textContent = Math.round(totalWeeklyHours * 10) / 10;
            document.getElementById('overtimeHours').textContent = Math.round(totalOvertimeHours * 10) / 10;
            document.getElementById('workDaysCount').textContent = workDaysThisMonth;
            
            var avgDaily = workDaysThisMonth > 0 ? totalWeeklyHours / 7 : 0;
            document.getElementById('avgDaily').textContent = Math.round(avgDaily * 10) / 10;
        }

        // פונקציות דוחות
        function generateDailyReport() {
            showAlert('מכין דוח יומי...', 'info');
            setTimeout(function() {
                var content = createDailyReportTable();
                showReportResults('דוח יומי - ' + getCurrentDate(), content);
                showAlert('דוח יומי הוכן בהצלחה!', 'success');
            }, 1000);
        }

        function generateWeeklyReport() {
            showAlert('מכין דוח שבועי...', 'info');
            setTimeout(function() {
                var content = createWeeklyReportTable();
                showReportResults('דוח שבועי - השבוע האחרון', content);
                showAlert('דוח שבועי הוכן בהצלחה!', 'success');
            }, 1000);
        }

        function generateMonthlyReport() {
            showAlert('מכין דוח חודשי...', 'info');
            setTimeout(function() {
                var content = createMonthlyReportTable();
                showReportResults('דוח חודשי - החודש הנוכחי', content);
                showAlert('דוח חודשי הוכן בהצלחה!', 'success');
            }, 1000);
        }

        function generateWorkDaysReport() {
            showAlert('מכין דוח ימי עבודה...', 'info');
            setTimeout(function() {
                var content = createWorkDaysReportTable();
                showReportResults('דוח ימי עבודה', content);
                showAlert('דוח ימי עבודה הוכן בהצלחה!', 'success');
            }, 1000);
        }

        function generateOvertimeReport() {
            showAlert('מכין דוח שעות נוספות...', 'info');
            setTimeout(function() {
                var content = createOvertimeReportTable();
                showReportResults('דוח שעות נוספות (מעל 9 שעות ביום)', content);
                showAlert('דוח שעות נוספות הוכן בהצלחה!', 'success');
            }, 1000);
        }

        function generatePayrollReport() {
            showAlert('מכין דוח שכר...', 'info');
            setTimeout(function() {
                var content = createPayrollReportTable();
                showReportResults('דוח נתונים למחלקת שכר', content);
                document.getElementById('payrollSection').style.display = 'block';
                updatePayrollSection();
                showAlert('דוח שכר הוכן בהצלחה!', 'success');
            }, 1000);
        }

        function generateCustomReport() {
            var employee = document.getElementById('employeeFilter').value;
            var startDate = document.getElementById('startDate').value;
            var endDate = document.getElementById('endDate').value;
            var reportType = document.getElementById('reportType').value;
            
            if (!startDate || !endDate) {
                showAlert('אנא בחר תאריכי התחלה וסיום', 'error');
                return;
            }
            
            showAlert('מכין דוח מותאם אישית...', 'info');
            setTimeout(function() {
                var content;
                var title = 'דוח מותאם - ' + startDate + ' עד ' + endDate;
                
                switch(reportType) {
                    case 'workdays':
                        content = createCustomWorkDaysReport(employee, startDate, endDate);
                        break;
                    case 'overtime':
                        content = createCustomOvertimeReport(employee, startDate, endDate);
                        break;
                    default:
                        content = createCustomReportTable(employee, startDate, endDate, reportType);
                }
                
                showReportResults(title, content);
                showAlert('דוח מותאם אישית הוכן בהצלחה!', 'success');
            }, 1000);
        }

        // יצירת טבלאות דוחות
        function createDailyReportTable() {
            var today = getCurrentDate();
            var html = '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>כניסה</th><th>יציאה</th><th>שעות עבודה</th><th>שעות נוספות</th><th>סטטוס</th>';
            html += '</tr></thead><tbody>';
            
            for (var i = 0; i < employees.length; i++) {
                var employee = employees[i];
                var todayData = attendanceData[employee] && attendanceData[employee][today];
                var status = currentStatus[employee] || 'out';
                
                var checkInTime = todayData && todayData.checkIn ? formatTime(todayData.checkIn) : '-';
                var checkOutTime = todayData && todayData.checkOut ? formatTime(todayData.checkOut) : (status === 'in' ? 'פעיל' : '-');
                
                var workHours = 0;
                var overtimeHours = 0;
                
                if (todayData && todayData.checkIn) {
                    workHours = calculateHours(todayData.checkIn, todayData.checkOut);
                    if (isOvertime(workHours)) {
                        overtimeHours = workHours - 9;
                    }
                }
                
                var statusText = status === 'in' ? '🟢 במשמרת' : '🔴 לא במשמרת';
                var overtimeClass = overtimeHours > 0 ? ' class="overtime-cell"' : '';
                
                html += '<tr>';
                html += '<td><strong>' + employee + '</strong></td>';
                html += '<td>' + checkInTime + '</td>';
                html += '<td>' + checkOutTime + '</td>';
                html += '<td' + overtimeClass + '>' + workHours.toFixed(1) + '</td>';
                html += '<td' + overtimeClass + '>' + (overtimeHours > 0 ? overtimeHours.toFixed(1) : '-') + '</td>';
                html += '<td>' + statusText + '</td>';
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportReport(\'daily\')">📤 ייצא דוח יומי</button>';
            html += '</div>';
            
            return html;
        }

        function createWeeklyReportTable() {
            var html = '<div class="stats-grid" style="margin-bottom: 20px;">';
            html += '<div style="background: #e3f2fd; color: #1976d2; padding: 15px; border-radius: 10px; text-align: center;">';
            html += '<strong>' + document.getElementById('weeklyHours').textContent + '</strong><br>שעות השבוע</div>';
            html += '<div style="background: #fff3e0; color: #f57c00; padding: 15px; border-radius: 10px; text-align: center;">';
            html += '<strong>' + document.getElementById('overtimeHours').textContent + '</strong><br>שעות נוספות</div>';
            html += '</div>';
            
            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>ראשון</th><th>שני</th><th>שלישי</th><th>רביעי</th><th>חמישי</th><th>שישי</th><th>שבת</th><th>סה"כ</th><th>נוספות</th>';
            html += '</tr></thead><tbody>';
            
            // חישוב תאריכי השבוע
            var weekStart = new Date();
            weekStart.setDate(weekStart.getDate() - weekStart.getDay());
            var weekDates = [];
            for (var i = 0; i < 7; i++) {
                var date = new Date(weekStart);
                date.setDate(weekStart.getDate() + i);
                var dateStr = date.getFullYear() + '-' + 
                    String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(date.getDate()).padStart(2, '0');
                weekDates.push(dateStr);
            }
            
            for (var e = 0; e < employees.length; e++) {
                var employee = employees[e];
                var weekTotal = 0;
                var weekOvertime = 0;
                
                html += '<tr><td><strong>' + employee + '</strong></td>';
                
                for (var d = 0; d < 7; d++) {
                    var dayData = attendanceData[employee] && attendanceData[employee][weekDates[d]];
                    var dayHours = 0;
                    
                    if (dayData && dayData.checkIn) {
                        dayHours = calculateHours(dayData.checkIn, dayData.checkOut);
                        weekTotal += dayHours;
                        
                        if (isOvertime(dayHours)) {
                            weekOvertime += (dayHours - 9);
                        }
                    }
                    
                    var cellClass = isOvertime(dayHours) ? ' class="overtime-cell"' : '';
                    html += '<td' + cellClass + '>' + (dayHours > 0 ? dayHours.toFixed(1) : '-') + '</td>';
                }
                
                var totalClass = weekOvertime > 0 ? ' class="overtime-cell"' : '';
                html += '<td' + totalClass + '><strong>' + weekTotal.toFixed(1) + '</strong></td>';
                html += '<td' + (weekOvertime > 0 ? ' class="overtime-cell"' : '') + '>' + 
                    (weekOvertime > 0 ? weekOvertime.toFixed(1) : '-') + '</td>';
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportReport(\'weekly\')">📤 ייצא דוח שבועי</button>';
            html += '</div>';
            
            return html;
        }

        function createMonthlyReportTable() {
            var html = '<div class="stats-grid" style="margin-bottom: 20px;">';
            html += '<div style="background: #e3f2fd; color: #1976d2; padding: 15px; border-radius: 10px; text-align: center;">';
            html += '<strong>' + document.getElementById('workDaysCount').textContent + '</strong><br>ימי עבודה</div>';
            html += '<div style="background: #fff3e0; color: #f57c00; padding: 15px; border-radius: 10px; text-align: center;">';
            html += '<strong>' + document.getElementById('overtimeHours').textContent + '</strong><br>שעות נוספות</div>';
            html += '</div>';
            
            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>ימי עבודה</th><th>סה"כ שעות</th><th>שעות נוספות</th><th>ממוצע יומי</th><th>ציון</th>';
            html += '</tr></thead><tbody>';
            
            // חישוב נתוני החודש
            var monthStart = new Date();
            monthStart.setDate(1);
            var monthDates = [];
            var currentMonth = new Date();
            for (var d = new Date(monthStart); d <= currentMonth; d.setDate(d.getDate() + 1)) {
                var dateStr = d.getFullYear() + '-' + 
                    String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(d.getDate()).padStart(2, '0');
                monthDates.push(dateStr);
            }
            
            for (var e = 0; e < employees.length; e++) {
                var employee = employees[e];
                var workDays = 0;
                var totalHours = 0;
                var totalOvertime = 0;
                
                for (var m = 0; m < monthDates.length; m++) {
                    var dayData = attendanceData[employee] && attendanceData[employee][monthDates[m]];
                    if (dayData && dayData.checkIn) {
                        workDays++;
                        var dayHours = calculateHours(dayData.checkIn, dayData.checkOut);
                        totalHours += dayHours;
                        
                        if (isOvertime(dayHours)) {
                            totalOvertime += (dayHours - 9);
                        }
                    }
                }
                
                var avgDaily = workDays > 0 ? totalHours / workDays : 0;
                var score = workDays >= 20 ? '🥇 מצוין' : workDays >= 15 ? '🥈 טוב' : '🥉 לשיפור';
                
                var overtimeClass = totalOvertime > 0 ? ' class="overtime-cell"' : '';
                
                html += '<tr>';
                html += '<td><strong>' + employee + '</strong></td>';
                html += '<td>' + workDays + '</td>';
                html += '<td>' + totalHours.toFixed(1) + '</td>';
                html += '<td' + overtimeClass + '>' + (totalOvertime > 0 ? totalOvertime.toFixed(1) : '-') + '</td>';
                html += '<td>' + avgDaily.toFixed(1) + '</td>';
                html += '<td>' + score + '</td>';
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportReport(\'monthly\')">📤 ייצא דוח חודשי</button>';
            html += '<button class="btn btn-warning" onclick="sendToPayroll()">💰 שלח לשכר</button>';
            html += '</div>';
            
            return html;
        }

        function createWorkDaysReportTable() {
            var html = '<div style="background: #e8f5e8; padding: 20px; border-radius: 15px; margin-bottom: 20px;">';
            html += '<h3 style="text-align: center; margin-bottom: 15px;">🗓️ ספירת ימי עבודה</h3>';
            html += '</div>';
            
            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>ימי עבודה החודש</th><th>ימי עבודה השבוע</th><th>ימי חיסור</th><th>נוכחות %</th>';
            html += '</tr></thead><tbody>';
            
            var today = new Date();
            var daysInMonth = today.getDate();
            
            for (var e = 0; e < employees.length; e++) {
                var employee = employees[e];
                var monthWorkDays = 0;
                var weekWorkDays = 0;
                
                // חישוב ימי עבודה החודש
                var monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
                for (var d = new Date(monthStart); d <= today; d.setDate(d.getDate() + 1)) {
                    var dateStr = d.getFullYear() + '-' + 
                        String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(d.getDate()).padStart(2, '0');
                    var dayData = attendanceData[employee] && attendanceData[employee][dateStr];
                    if (dayData && dayData.checkIn) {
                        monthWorkDays++;
                    }
                }
                
                // חישוב ימי עבודה השבוע
                var weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                for (var w = 0; w < 7; w++) {
                    var weekDate = new Date(weekStart);
                    weekDate.setDate(weekStart.getDate() + w);
                    if (weekDate <= today) {
                        var weekDateStr = weekDate.getFullYear() + '-' + 
                            String(weekDate.getMonth() + 1).padStart(2, '0') + '-' + 
                            String(weekDate.getDate()).padStart(2, '0');
                        var weekData = attendanceData[employee] && attendanceData[employee][weekDateStr];
                        if (weekData && weekData.checkIn) {
                            weekWorkDays++;
                        }
                    }
                }
                
                var absentDays = daysInMonth - monthWorkDays;
                var attendancePercent = Math.round((monthWorkDays / daysInMonth) * 100);
                
                html += '<tr>';
                html += '<td><strong>' + employee + '</strong></td>';
                html += '<td>' + monthWorkDays + '/' + daysInMonth + '</td>';
                html += '<td>' + weekWorkDays + '</td>';
                html += '<td' + (absentDays > 2 ? ' class="absent-cell"' : '') + '>' + absentDays + '</td>';
                html += '<td>' + attendancePercent + '%</td>';
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportReport(\'workdays\')">📤 ייצא דוח ימי עבודה</button>';
            html += '</div>';
            
            return html;
        }

        function createOvertimeReportTable() {
            var html = '<div style="background: #fff3e0; padding: 20px; border-radius: 15px; margin-bottom: 20px;">';
            html += '<h3 style="text-align: center; margin-bottom: 15px;">🌙 שעות נוספות (מעל 9 שעות ביום)</h3>';
            html += '<p style="text-align: center; color: #f57c00;">תשלום מוגדל על שעות מעל 9 שעות ביום</p>';
            html += '</div>';
            
            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>תאריך</th><th>שעות ביום</th><th>שעות נוספות</th><th>שכר נוסף (₪)</th>';
            html += '</tr></thead><tbody>';
            
            var totalOvertimePay = 0;
            var hourlyRate = 50; // שכר לשעה
            var overtimeMultiplier = 1.25; // 125% לשעות נוספות
            
            // חיפוש כל הימים עם שעות נוספות
            for (var e = 0; e < employees.length; e++) {
                var employee = employees[e];
                var employeeData = attendanceData[employee];
                
                if (employeeData) {
                    for (var date in employeeData) {
                        var dayData = employeeData[date];
                        if (dayData && dayData.checkIn && dayData.checkOut) {
                            var dayHours = calculateHours(dayData.checkIn, dayData.checkOut);
                            if (isOvertime(dayHours)) {
                                var overtimeHours = dayHours - 9;
                                var overtimePay = overtimeHours * hourlyRate * overtimeMultiplier;
                                totalOvertimePay += overtimePay;
                                
                                html += '<tr class="overtime-cell">';
                                html += '<td><strong>' + employee + '</strong></td>';
                                html += '<td>' + date + '</td>';
                                html += '<td>' + dayHours.toFixed(1) + '</td>';
                                html += '<td>' + overtimeHours.toFixed(1) + '</td>';
                                html += '<td>₪' + overtimePay.toFixed(0) + '</td>';
                                html += '</tr>';
                            }
                        }
                    }
                }
            }
            
            if (totalOvertimePay === 0) {
                html += '<tr><td colspan="5" style="text-align: center; color: #666;">אין שעות נוספות לתקופה זו</td></tr>';
            }
            
            html += '</tbody></table></div>';
            
            if (totalOvertimePay > 0) {
                html += '<div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center;">';
                html += '<h4>💰 סה"כ עלות שעות נוספות: ₪' + totalOvertimePay.toFixed(0) + '</h4>';
                html += '</div>';
            }
            
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportReport(\'overtime\')">📤 ייצא דוח נוספות</button>';
            html += '<button class="btn btn-warning" onclick="sendOvertimeToPayroll()">💰 שלח לשכר</button>';
            html += '</div>';
            
            return html;
        }

        function createPayrollReportTable() {
            var html = '<div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px;">';
            html += '<h3 style="text-align: center; margin-bottom: 15px;">💰 נתוני שכר לחודש</h3>';
            html += '</div>';
            
            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>ימי עבודה</th><th>שעות רגילות</th><th>שעות נוספות</th><th>שכר רגיל</th><th>שכר נוסף</th><th>סה"כ</th>';
            html += '</tr></thead><tbody>';
            
            var hourlyRate = 50;
            var overtimeMultiplier = 1.25;
            var totalPayroll = 0;
            
            for (var e = 0; e < employees.length; e++) {
                var employee = employees[e];
                var workDays = 0;
                var regularHours = 0;
                var overtimeHours = 0;
                
                // חישוב נתוני החודש
                var monthStart = new Date();
                monthStart.setDate(1);
                var monthDates = [];
                var currentMonth = new Date();
                for (var d = new Date(monthStart); d <= currentMonth; d.setDate(d.getDate() + 1)) {
                    var dateStr = d.getFullYear() + '-' + 
                        String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(d.getDate()).padStart(2, '0');
                    monthDates.push(dateStr);
                }
                
                for (var m = 0; m < monthDates.length; m++) {
                    var dayData = attendanceData[employee] && attendanceData[employee][monthDates[m]];
                    if (dayData && dayData.checkIn && dayData.checkOut) {
                        workDays++;
                        var dayHours = calculateHours(dayData.checkIn, dayData.checkOut);
                        
                        if (dayHours <= 9) {
                            regularHours += dayHours;
                        } else {
                            regularHours += 9;
                            overtimeHours += (dayHours - 9);
                        }
                    }
                }
                
                var regularPay = regularHours * hourlyRate;
                var overtimePay = overtimeHours * hourlyRate * overtimeMultiplier;
                var totalPay = regularPay + overtimePay;
                totalPayroll += totalPay;
                
                html += '<tr>';
                html += '<td><strong>' + employee + '</strong></td>';
                html += '<td>' + workDays + '</td>';
                html += '<td>' + regularHours.toFixed(1) + '</td>';
                html += '<td' + (overtimeHours > 0 ? ' class="overtime-cell"' : '') + '>' + (overtimeHours > 0 ? overtimeHours.toFixed(1) : '-') + '</td>';
                html += '<td>₪' + regularPay.toFixed(0) + '</td>';
                html += '<td' + (overtimePay > 0 ? ' class="overtime-cell"' : '') + '>' + (overtimePay > 0 ? '₪' + overtimePay.toFixed(0) : '-') + '</td>';
                html += '<td><strong>₪' + totalPay.toFixed(0) + '</strong></td>';
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            
            html += '<div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center;">';
            html += '<h4>💰 סה"כ עלות שכר: ₪' + totalPayroll.toFixed(0) + '</h4>';
            html += '</div>';
            
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportPayrollData()">📤 ייצא נתוני שכר</button>';
            html += '<button class="btn btn-info" onclick="emailPayrollData()">📧 שלח למחלקת שכר</button>';
            html += '</div>';
            
            return html;
        }

        function createCustomReportTable(employee, startDate, endDate, reportType) {
            var employeeText = employee === 'all' ? 'כל העובדים' : employee;
            var typeText = {
                'summary': 'סיכום כללי',
                'detailed': 'מפורט',
                'hours': 'שעות בלבד',
                'attendance': 'נוכחות בלבד'
            }[reportType];

            var html = '<div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">';
            html += '<h3>📊 דוח מותאם אישית</h3>';
            html += '<p><strong>עובד:</strong> ' + employeeText + ' | <strong>תקופה:</strong> ' + startDate + ' - ' + endDate + '</p>';
            html += '<p><strong>סוג:</strong> ' + typeText + '</p>';
            html += '</div>';

            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>תאריך</th><th>עובד</th><th>כניסה</th><th>יציאה</th><th>שעות</th><th>נוספות</th><th>סטטוס</th>';
            html += '</tr></thead><tbody>';
            
            // יצירת טווח תאריכים
            var start = new Date(startDate);
            var end = new Date(endDate);
            var employeesToShow = employee === 'all' ? employees : [employee];
            
            for (var d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                var dateStr = d.getFullYear() + '-' + 
                    String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(d.getDate()).padStart(2, '0');
                
                for (var e = 0; e < employeesToShow.length; e++) {
                    var emp = employeesToShow[e];
                    var dayData = attendanceData[emp] && attendanceData[emp][dateStr];
                    
                    if (dayData && dayData.checkIn) {
                        var checkIn = formatTime(dayData.checkIn);
                        var checkOut = dayData.checkOut ? formatTime(dayData.checkOut) : 'לא נסגר';
                        var hours = calculateHours(dayData.checkIn, dayData.checkOut);
                        var overtime = isOvertime(hours) ? (hours - 9).toFixed(1) : '-';
                        var status = dayData.checkOut ? '✅ הושלם' : '🟡 פעיל';
                        
                        var overtimeClass = isOvertime(hours) ? ' class="overtime-cell"' : '';
                        
                        html += '<tr>';
                        html += '<td>' + dateStr + '</td>';
                        html += '<td>' + emp + '</td>';
                        html += '<td>' + checkIn + '</td>';
                        html += '<td>' + checkOut + '</td>';
                        html += '<td' + overtimeClass + '>' + hours.toFixed(1) + '</td>';
                        html += '<td' + overtimeClass + '>' + overtime + '</td>';
                        html += '<td>' + status + '</td>';
                        html += '</tr>';
                    }
                }
            }
            
            html += '</tbody></table></div>';
            html += '<div style="margin-top: 20px; text-align: center;">';
            html += '<button class="btn btn-success" onclick="exportCustomReport()">📤 ייצא דוח</button>';
            html += '</div>';
            
            return html;
        }

        function updatePayrollSection() {
            var html = '';
            var totalPayroll = 0;
            var totalRegularHours = 0;
            var totalOvertimeHours = 0;
            var hourlyRate = 50;
            var overtimeMultiplier = 1.25;
            
            // חישוב נתוני החודש
            var monthStart = new Date();
            monthStart.setDate(1);
            var monthDates = [];
            var currentMonth = new Date();
            for (var d = new Date(monthStart); d <= currentMonth; d.setDate(d.getDate() + 1)) {
                var dateStr = d.getFullYear() + '-' + 
                    String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(d.getDate()).padStart(2, '0');
                monthDates.push(dateStr);
            }
            
            for (var e = 0; e < employees.length; e++) {
                var employee = employees[e];
                var regularHours = 0;
                var overtimeHours = 0;
                
                for (var m = 0; m < monthDates.length; m++) {
                    var dayData = attendanceData[employee] && attendanceData[employee][monthDates[m]];
                    if (dayData && dayData.checkIn && dayData.checkOut) {
                        var dayHours = calculateHours(dayData.checkIn, dayData.checkOut);
                        
                        if (dayHours <= 9) {
                            regularHours += dayHours;
                        } else {
                            regularHours += 9;
                            overtimeHours += (dayHours - 9);
                        }
                    }
                }
                
                var regularPay = regularHours * hourlyRate;
                var overtimePay = overtimeHours * hourlyRate * overtimeMultiplier;
                var totalPay = regularPay + overtimePay;
                
                totalPayroll += totalPay;
                totalRegularHours += regularHours;
                totalOvertimeHours += overtimeHours;
            }
            
            html += '<div class="payroll-item">';
            html += '<h4>שעות רגילות</h4>';
            html += '<p>' + totalRegularHours.toFixed(1) + ' שעות</p>';
            html += '</div>';
            
            html += '<div class="payroll-item">';
            html += '<h4>שעות נוספות</h4>';
            html += '<p>' + totalOvertimeHours.toFixed(1) + ' שעות</p>';
            html += '</div>';
            
            html += '<div class="payroll-item">';
            html += '<h4>סה"כ לתשלום</h4>';
            html += '<p>₪' + totalPayroll.toFixed(0) + '</p>';
            html += '</div>';
            
            document.getElementById('payrollInfo').innerHTML = html;
        }

        // פונקציות עזר נוספות
        function showReportResults(title, content) {
            var resultsDiv = document.getElementById('reportResults');
            var contentDiv = document.getElementById('reportContent');
            
            contentDiv.innerHTML = '<h3 style="margin-bottom: 20px;">' + title + '</h3>' + content;
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // פונקציות ייצוא ושליחה
        function exportReport(type) {
            showAlert('מייצא דוח ' + type + '... 📤', 'info');
            setTimeout(function() {
                // כאן תוכל להוסיף קוד ייצא אמיתי
                showAlert('דוח ' + type + ' יוצא בהצלחה! ✅', 'success');
            }, 1500);
        }

        function exportToExcel() {
            showAlert('מייצא לאקסל... 📊', 'info');
            setTimeout(function() {
                showAlert('הדוח יוצא לאקסל בהצלחה! ✅', 'success');
            }, 1500);
        }

        function exportCustomReport() {
            exportReport('מותאם אישית');
        }

        function exportPayrollData() {
            showAlert('מייצא נתוני שכר... 💰', 'info');
            setTimeout(function() {
                showAlert('נתוני שכר יוצאו בהצלחה! ✅', 'success');
            }, 1500);
        }

        function emailReport() {
            var email = prompt('הזן כתובת מייל לשליחת הדוח:', 'manager@raftingbar.com');
            if (email) {
                showAlert('שולח דוח למייל ' + email + '... 📧', 'info');
                setTimeout(function() {
                    showAlert('דוח נשלח בהצלחה למייל ' + email + '! ✅', 'success');
                }, 2000);
            }
        }

        function emailPayrollData() {
            var email = prompt('הזן כתובת מייל של מחלקת השכר:', 'payroll@raftingbar.com');
            if (email) {
                showAlert('שולח נתוני שכר למייל ' + email + '... 📧', 'info');
                setTimeout(function() {
                    showAlert('נתוני שכר נשלחו בהצלחה! 💰', 'success');
                }, 2000);
            }
        }

        function sendToPayroll() {
            showAlert('מכין נתונים למחלקת שכר... 💰', 'info');
            setTimeout(function() {
                document.getElementById('payrollSection').style.display = 'block';
                updatePayrollSection();
                document.getElementById('payrollSection').scrollIntoView({ behavior: 'smooth' });
                showAlert('נתוני שכר מוכנים לשליחה! 💰', 'success');
            }, 1500);
        }

        function sendOvertimeToPayroll() {
            showAlert('שולח נתוני שעות נוספות למחלקת שכר... 🌙', 'info');
            setTimeout(function() {
                showAlert('נתוני שעות נוספות נשלחו בהצלחה! ✅', 'success');
            }, 2000);
        }

        // פונקציות דוחות מותאמים נוספים
        function createCustomWorkDaysReport(employee, startDate, endDate) {
            var employeeText = employee === 'all' ? 'כל העובדים' : employee;
            
            var html = '<div style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">';
            html += '<h3>🗓️ דוח ימי עבודה מותאם</h3>';
            html += '<p><strong>עובד:</strong> ' + employeeText + ' | <strong>תקופה:</strong> ' + startDate + ' - ' + endDate + '</p>';
            html += '</div>';

            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>עובד</th><th>ימי עבודה</th><th>ימי חיסור</th><th>נוכחות %</th><th>הערות</th>';
            html += '</tr></thead><tbody>';
            
            var start = new Date(startDate);
            var end = new Date(endDate);
            var totalDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            var employeesToShow = employee === 'all' ? employees : [employee];
            
            for (var e = 0; e < employeesToShow.length; e++) {
                var emp = employeesToShow[e];
                var workDays = 0;
                
                for (var d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    var dateStr = d.getFullYear() + '-' + 
                        String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                        String(d.getDate()).padStart(2, '0');
                    var dayData = attendanceData[emp] && attendanceData[emp][dateStr];
                    if (dayData && dayData.checkIn) {
                        workDays++;
                    }
                }
                
                var absentDays = totalDays - workDays;
                var attendancePercent = Math.round((workDays / totalDays) * 100);
                var grade = attendancePercent >= 90 ? 'מצוין' : attendancePercent >= 75 ? 'טוב' : 'לשיפור';
                
                html += '<tr>';
                html += '<td><strong>' + emp + '</strong></td>';
                html += '<td>' + workDays + '/' + totalDays + '</td>';
                html += '<td' + (absentDays > 2 ? ' class="absent-cell"' : '') + '>' + absentDays + '</td>';
                html += '<td>' + attendancePercent + '%</td>';
                html += '<td>' + grade + '</td>';
                html += '</tr>';
            }
            
            html += '</tbody></table></div>';
            return html;
        }

        function createCustomOvertimeReport(employee, startDate, endDate) {
            var employeeText = employee === 'all' ? 'כל העובדים' : employee;
            
            var html = '<div style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">';
            html += '<h3>🌙 דוח שעות נוספות מותאם</h3>';
            html += '<p><strong>עובד:</strong> ' + employeeText + ' | <strong>תקופה:</strong> ' + startDate + ' - ' + endDate + '</p>';
            html += '<p>שעות מעל 9 שעות ביום</p>';
            html += '</div>';

            html += '<div class="table-container"><table class="data-table">';
            html += '<thead><tr>';
            html += '<th>תאריך</th><th>עובד</th><th>שעות ביום</th><th>שעות נוספות</th><th>שכר נוסף</th>';
            html += '</tr></thead><tbody>';
            
            var start = new Date(startDate);
            var end = new Date(endDate);
            var employeesToShow = employee === 'all' ? employees : [employee];
            var totalOvertimePay = 0;
            var hourlyRate = 50;
            var overtimeMultiplier = 1.25;
            var hasOvertime = false;
            
            for (var d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                var dateStr = d.getFullYear() + '-' + 
                    String(d.getMonth() + 1).padStart(2, '0') + '-' + 
                    String(d.getDate()).padStart(2, '0');
                
                for (var e = 0; e < employeesToShow.length; e++) {
                    var emp = employeesToShow[e];
                    var dayData = attendanceData[emp] && attendanceData[emp][dateStr];
                    
                    if (dayData && dayData.checkIn && dayData.checkOut) {
                        var dayHours = calculateHours(dayData.checkIn, dayData.checkOut);
                        if (isOvertime(dayHours)) {
                            hasOvertime = true;
                            var overtimeHours = dayHours - 9;
                            var overtimePay = overtimeHours * hourlyRate * overtimeMultiplier;
                            totalOvertimePay += overtimePay;
                            
                            html += '<tr class="overtime-cell">';
                            html += '<td>' + dateStr + '</td>';
                            html += '<td>' + emp + '</td>';
                            html += '<td>' + dayHours.toFixed(1) + '</td>';
                            html += '<td>' + overtimeHours.toFixed(1) + '</td>';
                            html += '<td>₪' + overtimePay.toFixed(0) + '</td>';
                            html += '</tr>';
                        }
                    }
                }
            }
            
            if (!hasOvertime) {
                html += '<tr><td colspan="5" style="text-align: center; color: #666;">אין שעות נוספות בתקופה זו</td></tr>';
            }
            
            html += '</tbody></table></div>';
            
            if (totalOvertimePay > 0) {
                html += '<div style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center;">';
                html += '<h4>💰 סה"כ עלות שעות נוספות: ₪' + totalOvertimePay.toFixed(0) + '</h4>';
                html += '</div>';
            }
            
            return html;
        }

        // אתחול
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setDefaultDates();
            
            // עדכון סטטיסטיקות כל 30 שניות
            setInterval(function() {
                loadData();
            }, 30000);
        });
    </script>
</body>
</html>
